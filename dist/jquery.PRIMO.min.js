!function(e){function t(e){var t=null,n=jQuery(jQuery(".EXLResult")[e]);return n.index=e,n.id=n.find(".EXLResultRecordId[name]").attr("name"),n.title=n.find(".EXLResultTitle").text().trim(),n.openUrl=n.find(".EXLMoreTab a").attr("href"),n.tabs=l(n),n.getIt1=function(){return r(n)},n.getDedupedRecordIds=function(){return a(n.id).data()},n.isRemoteRecord=function(){return"TN"===n.id.substring(0,2)}(),n.getData=function(){if(!t){var e=f(n.id,"json");e&&e.length>0&&(t=e[0])}return t},n.getPNX=function(e){return f(n.id,e)},n}function n(e){return-1!=e.search(/^dedupmrg/)}function a(e){var t=[];return{data:function(){return 0===t.length&&n(e)&&jQuery.ajax({async:!1,type:"get",dataType:"json",data:{id:e},url:"/primo_library/libweb/dedup_records_helper.jsp"}).done(function(e){t=e}),t}}}function r(t){var n=t.tabs.getByName("ViewOnline"),a="";return n&&n.length>0&&(a=e(n.find('input[id*="getitonline1"]')).val().split("O4=")[1].split("O5=")[0].replace(/delivery,.*?,/,"")),a}function i(t,n){var a=null;if("number"==typeof n?a=t.find(".EXLResultTab")[n]:"string"==typeof n&&(a=t.find('.EXLResultTab:contains("'+n+'")'),(null==a||0==a.length)&&(a=e(t.tabs).find('a[title*="'+n+'"]').parent()),(null==a||0==a.length)&&(a=e(t).find('li[class*="'+n+'"]'))),null!==a){var r=jQuery(a).find("a").text().trim(),i=null;jQuery.each(r.toLowerCase().replace(/\s/g,"").split("&"),function(){c=t.find('*[class*="Container-'+this+'"]'),c.length>0&&(i=c)}),a.index=n,a.name=r,a.container=i,a.isOpen=function(){return jQuery(a).hasClass("EXLResultSelectedTab")},a.close=function(){jQuery.PRIMO.session.view.isFullDisplay||(t.find(".EXLResultSelectedTab").removeClass("EXLResultSelectedTab"),t.find(".EXLTabsRibbon").addClass("EXLTabsRibbonClosed"),a.container.hide())},a.open=function(e,n){defaults={reload:!1,headerContent:"",url:"#"};var a=jQuery.extend(defaults,n);if(currentTab=t.tabs.getByName(r),t.find(".EXLTabsRibbonClosed").removeClass("EXLTabsRibbonClosed"),t.find(".EXLResultSelectedTab").removeClass("EXLResultSelectedTab"),jQuery(currentTab).addClass("EXLResultSelectedTab"),t.find(".EXLResultTabContainer").hide(),currentTab.container.show(),!currentTab.container.data("loaded")||a.reload){var i='<div class="EXLTabHeaderContent">'+a.headerContent+'</div><div class="EXLTabHeaderButtons"><ul><li class="EXLTabHeaderButtonPopout"><span></span><a href="'+a.url+'" target="_blank"><img src="../images/icon_popout_tab.png" /></a></li><li></li><li class="EXLTabHeaderButtonCloseTabs"><a href="#" title="hide tabs"><img src="../images/icon_close_tabs.png" alt="hide tabs"></a></li></ul></div>',l='<div class="EXLTabHeader">'+i+"</div>",u='<div class="EXLTabContent">'+e+"</div>";currentTab.container.html(l+u),currentTab.container.data("loaded",!0)}}}return a}function l(e){var t=[],n=e.find(".EXLResultTab").length;for(k=0;n>k;k++)t.push(i(e,k));return null==t.addTab&&(t.addTab=function(t,n){n.record=e,u(t,n)}),t.getNames=function(){return tabNames=[],jQuery.each(t,function(){tabNames.push(this.name)}),tabNames},t.getEnabled=function(){return jQuery.map(e.find(".EXLResultTab"),function(e){return e=jQuery(e),"none"!=e.css("display")?jQuery(e).text().trim():null})},t.getByName=function(t){return i(e,t)},t}function u(e,t){defaults={record:null,state:"disabled",css:e.replace(" ","").toLowerCase()+"Tab",url:"#",tooltip:"",headerContent:"",click:function(){alert("To be implemented...")}};var n=jQuery.extend(defaults,t);if(jQuery.inArray(e,n.record.tabs.getNames())<0){var a='<li class="EXLResultTab '+n.css+'">';a+='  <span style="display:'+("disabled"==n.state?"block":"none")+'">'+e+"</span>",a+='  <a style="display:'+("disabled"==n.state?"none":"block")+'" title="'+n.tooltip+'" href="'+n.url+'">'+e+"</a>",a+="</li>";var r='<div class="EXLResultTabContainer EXLContainer-'+n.css+'"></div>';n.record.find(".EXLResultTab").last().after(a),n.record.hasClass("EXLSummary")?n.record.append(r):n.record.find(".EXLSummary").append(r);var i="."+n.css+" a";n.record.find(i).click(function(t){t.preventDefault(),"enabled"==n.state&&(tab=n.record.tabs.getByName(e),n.click(t,tab,n.record,n))})}n.record.tabs=l(n.record)}function s(t,n){function a(t,l){if(!t)return null;{var u="",s=null,o=null;t.nodeType,r(t.localName||t.nodeName),t.text||t.nodeValue||""}t.childNodes&&t.childNodes.length>0&&e.each(t.childNodes,function(e,t){var n=t.nodeType,l=r(t.localName||t.nodeName),o=t.text||t.nodeValue||"";if(8!=n)if(3!=n&&4!=n&&l)s=s||{},s[l]?(s[l].length||(s[l]=i(s[l])),s[l]=i(s[l]),s[l][s[l].length]=a(t,!0),s[l].length=s[l].length):s[l]=a(t);else{if(o.match(/^\s+$/))return;u+=o.replace(/^\s+/,"").replace(/\s+$/,"")}}),t.attributes&&t.attributes.length>0&&(o={},s=s||{},e.each(t.attributes,function(e,t){var n=r(t.name),a=t.value;o[n]=a,s[n]?(s[cnn]=i(s[cnn]),s[n][s[n].length]=a,s[n].length=s[n].length):s[n]=a})),s&&(s=e.extend(""!=u?new String(u):{},s||{}),u=s.text?[s.text||""].concat([u]):u,u&&(s.text=u),u="");var d=s||u;return n&&(u&&(d={}),u=d.text||u||"",u&&(d.text=u),l||(d=i(d))),d}if(!t)return{};var r=function(e){return String(e||"").replace(/-/g,"_")},i=function(t){return e.isArray(t)||(t=[t]),t.length=t.length,t};if("string"==typeof t&&(t=o(t)),t.nodeType){if(3==t.nodeType||4==t.nodeType)return t.nodeValue;var l=9==t.nodeType?t.documentElement:t,u=a(l,!0);return t=null,l=null,u}}function o(t){return e.parseXML(t)}function d(e){var t;return t=window.ActiveXObject?e.xml:(new XMLSerializer).serializeToString(e)}var f=function(t,n){var a=null;return void 0===n&&(n="text"),jQuery.ajax({async:!1,type:"get",dataType:"xml",url:"/primo_library/libweb/action/display.do?vid="+jQuery.PRIMO.session.view.code+"&showPnx=true&pds_handle=GUEST&doc="+t,success:function(t,r,i){if(i.getResponseHeader("Content-Type").search(/xml/)>=0)switch(n){case"text":a=d(t);break;case"json":a=e(s(t));break;default:a=e(t)}else alert("PDS redirect detected. Do not know how to handle that, yet.")}}),a},b=function(){var t=null;return{data:function(){return t?void 0:(t={},jQuery.ajax({async:!1,type:"get",dataType:"json",url:"/primo_library/libweb/remote_session_data_helper.jsp"}).done(function(e){t=e}).fail(function(){t={view:{},user:{id:p.data().id,name:p.data().name,isLoggedIn:function(){return p.data().loggedIn}}}}),e.extend(t.view,{isFullDisplay:function(){return window.isFullDisplay()}(),frontEndID:function(){return y.data()}()}),t)}}}(),p=function(){var t=null;return{data:function(){return t||(t={},jQuery.ajax({async:!1,type:"get",dataType:"xml",url:"/primo_library/libweb/getUserInfoServlet",success:function(n){t.id=e(n).find("userId").text(),t.name=e(n).find("userName").text(),t.loggedIn="true"===e(n).find("isLoggedIn").text()}})),t}}}(),y=function(){var e=null;return{data:function(){return e||(e="unknown",jQuery.ajax({async:!1,type:"get",url:"/primo_library/libweb/static_htmls/header.html",complete:function(t){e=t.getResponseHeader("X-PRIMO-FE-ENVIRONMENT")}})),e}}}();jQuery.PRIMO={session:function(){return b.data()}(),records:function(){for(var n=jQuery(".EXLResult").length,a=[],r=0;n>r;r++)a.push(t(r));return e(a)}()}}(jQuery);